import{C as f,F as g,H as S,x as d}from"./chunk-IJ5PMWPP.js";import{L as u,O as s,P as l,fa as m,i as c,ib as r,rb as h}from"./chunk-WILH2WMB.js";var x=(()=>{class o{constructor(t,e){this.router=t,this.platformId=e,this.currentUserSubject=new c(null),this.currentUser$=this.currentUserSubject.asObservable(),this.auth=l(d),r(this.platformId)&&this.initializeAuthState()}initializeAuthState(){r(this.platformId)&&f(this.auth,t=>{if(t){let e={id:t.uid,email:t.email||"",name:t.displayName||"Administrador",role:"admin"};localStorage.setItem("admin_token","firebase-auth-"+t.uid),localStorage.setItem("user_role",e.role),localStorage.setItem("user_data",JSON.stringify(e)),this.currentUserSubject.next(e)}else this.clearLocalStorage(),this.currentUserSubject.next(null)})}login(t,e){return new Promise(a=>{g(this.auth,t,e).then(i=>{i.user?a(!0):a(!1)}).catch(i=>{if(console.log("Firebase Auth fall\xF3:",i),t==="admin@cuacdesign.com"&&e==="admin123"){let n={id:"local-admin",email:t,name:"Administrador Local",role:"admin"};r(this.platformId)&&(localStorage.setItem("admin_token","local-token-"+Date.now()),localStorage.setItem("user_role",n.role),localStorage.setItem("user_data",JSON.stringify(n))),this.currentUserSubject.next(n),a(!0)}else a(!1)})})}logout(){S(this.auth).then(()=>{console.log("Sesi\xF3n cerrada en Firebase")}).catch(t=>{console.error("Error cerrando sesi\xF3n en Firebase:",t)}),r(this.platformId)&&this.clearLocalStorage(),this.currentUserSubject.next(null),this.router.navigate(["/admin/login"])}isAuthenticated(){if(!r(this.platformId))return!1;if(this.auth.currentUser)return!0;let t=localStorage.getItem("admin_token"),e=localStorage.getItem("user_role");return t&&e==="admin"?(this.currentUserSubject.value||this.checkStoredAuth(),!!this.currentUserSubject.value):!1}getCurrentUser(){return this.currentUserSubject.value}checkStoredAuth(){if(!r(this.platformId))return;let t=localStorage.getItem("user_data");if(t)try{let e=JSON.parse(t);this.currentUserSubject.next(e)}catch(e){console.error("Error parsing stored user data:",e),this.logout()}}isTokenExpired(){if(!r(this.platformId))return!0;if(this.auth.currentUser)return!1;let t=localStorage.getItem("admin_token");if(!t)return!0;if(t.startsWith("firebase-auth-"))return!1;let e=parseInt(t.split("-").pop()||"0"),i=Date.now()-e,n=24*60*60*1e3;return i>n}clearLocalStorage(){localStorage.removeItem("admin_token"),localStorage.removeItem("user_role"),localStorage.removeItem("user_data")}static{this.\u0275fac=function(e){return new(e||o)(s(h),s(m))}}static{this.\u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{x as a};
